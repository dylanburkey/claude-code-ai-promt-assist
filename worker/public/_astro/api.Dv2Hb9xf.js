var j=Object.defineProperty;var O=(s,e,t)=>e in s?j(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var l=(s,e,t)=>O(s,typeof e!="symbol"?e+"":e,t);const m={UI_STATE:"prompt_workstation_ui_state",SELECTED_AGENT:"prompt_workstation_selected_agent",SELECTED_REQUIREMENT:"prompt_workstation_selected_requirement",CURRENT_PROJECT:"prompt_workstation_current_project",FORM_DRAFTS:"prompt_workstation_form_drafts",THEME_PREFERENCES:"prompt_workstation_theme_preferences",CACHED_DATA:"prompt_workstation_cached_data"};class b{isAvailable(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}set(e,t){if(!this.isAvailable())return!1;try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch(r){return console.warn("Failed to save to localStorage:",r),!1}}get(e,t){if(!this.isAvailable())return t||null;try{const r=localStorage.getItem(e);return r?JSON.parse(r):t||null}catch(r){return console.warn("Failed to read from localStorage:",r),t||null}}remove(e){if(!this.isAvailable())return!1;try{return localStorage.removeItem(e),!0}catch(t){return console.warn("Failed to remove from localStorage:",t),!1}}clear(){if(!this.isAvailable())return!1;try{return localStorage.clear(),!0}catch(e){return console.warn("Failed to clear localStorage:",e),!1}}}const d=new b,A={save(s){const t={...this.load(),...s};return d.set(m.UI_STATE,t)},load(){return d.get(m.UI_STATE,{selectedAgentId:null,selectedRequirementId:null,currentProjectId:null,sidebarOpen:!1,activeView:"builder",syncStatus:"synced"})},clear(){return d.remove(m.UI_STATE)}},y={set(s,e,t=300*1e3){const r=this.getAll();return r[s]={data:e,timestamp:Date.now()+t},d.set(m.CACHED_DATA,r)},get(s){const t=this.getAll()[s];return t?Date.now()>t.timestamp?(this.remove(s),null):t.data:null},remove(s){const e=this.getAll();return delete e[s],d.set(m.CACHED_DATA,e)},getAll(){return d.get(m.CACHED_DATA,{})},clear(){return d.remove(m.CACHED_DATA)},isValid(s){const t=this.getAll()[s];return t?Date.now()<=t.timestamp:!1}},v={getUsage(){if(!d.isAvailable())return{used:0,available:0,percentage:0};let s=0;for(let r in localStorage)localStorage.hasOwnProperty(r)&&(s+=localStorage[r].length+r.length);const e=5*1024*1024,t=s/e*100;return{used:s,available:e,percentage:t}},cleanup(){const s=y.getAll();let e=!1;for(const t in s){const r=s[t];r&&Date.now()>r.timestamp&&(delete s[t],e=!0)}return e?d.set(m.CACHED_DATA,s):!0},exportAll(){const s={};for(const e of Object.values(m)){const t=d.get(e);t!==null&&(s[e]=t)}return s},importAll(s){try{for(const[e,t]of Object.entries(s))Object.values(m).includes(e)&&d.set(e,t);return!0}catch(e){return console.error("Failed to import storage data:",e),!1}}};typeof window<"u"&&v.cleanup();class _{constructor(e){l(this,"_state");l(this,"listeners",new Set);l(this,"errorHandlers",new Set);this._state=e}get state(){return this._state}setState(e){try{const t={...this._state};typeof e=="function"?this._state=e(this._state):this._state={...this._state,...e},this.listeners.forEach(r=>{try{r(this._state,t)}catch(a){this.handleError(a,"state_listener")}})}catch(t){this.handleError(t,"state_update")}}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}onError(e){return this.errorHandlers.add(e),()=>this.errorHandlers.delete(e)}handleError(e,t){this.errorHandlers.forEach(r=>{try{r(e,t)}catch(a){console.error("Error in error handler:",a)}}),this.errorHandlers.size===0&&console.error(`State error in ${t}:`,e)}}const q={agents:[],outputRequirements:[],projects:[],ui:{selectedAgentId:null,selectedRequirementId:null,currentProjectId:null,sidebarOpen:!1,activeView:"builder",syncStatus:"synced"},loading:{agents:!1,requirements:!1,projects:!1,saving:!1},errors:{agents:null,requirements:null,projects:null,network:null},toasts:[],progress:null,sync:{lastSync:null,status:"idle",pendingChanges:0}};class C extends _{constructor(){super(q);l(this,"persistenceEnabled",!0);l(this,"autoSaveTimeout",null);this.loadPersistedState(),this.setupAutoSave()}loadPersistedState(){try{const t=A.load();this.setState(u=>({...u,ui:{...u.ui,...t}}));const r=y.get("agents"),a=y.get("requirements"),i=y.get("projects");r&&this.setState(u=>({...u,agents:r})),a&&this.setState(u=>({...u,outputRequirements:a})),i&&this.setState(u=>({...u,projects:i}))}catch(t){this.handleError(t,"load_persisted_state")}}setupAutoSave(){this.subscribe(t=>{this.persistenceEnabled&&(this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=window.setTimeout(()=>{this.persistState(t)},500))})}persistState(t){try{A.save(t.ui),y.set("agents",t.agents,600*1e3),y.set("requirements",t.outputRequirements,600*1e3),y.set("projects",t.projects,600*1e3)}catch(r){this.handleError(r,"persist_state")}}setAgents(t){this.setState(r=>({...r,agents:t,errors:{...r.errors,agents:null}}))}addAgent(t){this.setState(r=>({...r,agents:[...r.agents,t]}))}updateAgent(t,r){this.setState(a=>({...a,agents:a.agents.map(i=>i.id===t?{...i,...r}:i)}))}removeAgent(t){this.setState(r=>({...r,agents:r.agents.filter(a=>a.id!==t),ui:r.ui.selectedAgentId===t?{...r.ui,selectedAgentId:null}:r.ui}))}setOutputRequirements(t){this.setState(r=>({...r,outputRequirements:t,errors:{...r.errors,requirements:null}}))}addOutputRequirement(t){this.setState(r=>({...r,outputRequirements:[...r.outputRequirements,t]}))}updateOutputRequirement(t,r){this.setState(a=>({...a,outputRequirements:a.outputRequirements.map(i=>i.id===t?{...i,...r}:i)}))}removeOutputRequirement(t){this.setState(r=>({...r,outputRequirements:r.outputRequirements.filter(a=>a.id!==t),ui:r.ui.selectedRequirementId===t?{...r.ui,selectedRequirementId:null}:r.ui}))}setProjects(t){this.setState(r=>({...r,projects:t,errors:{...r.errors,projects:null}}))}addProject(t){this.setState(r=>({...r,projects:[...r.projects,t]}))}updateProject(t,r){this.setState(a=>({...a,projects:a.projects.map(i=>i.id===t?{...i,...r}:i)}))}removeProject(t){this.setState(r=>({...r,projects:r.projects.filter(a=>a.id!==t),ui:r.ui.currentProjectId===t?{...r.ui,currentProjectId:null}:r.ui}))}setSelectedAgent(t){this.setState(r=>({...r,ui:{...r.ui,selectedAgentId:t}}))}setSelectedRequirement(t){this.setState(r=>({...r,ui:{...r.ui,selectedRequirementId:t}}))}setCurrentProject(t){this.setState(r=>({...r,ui:{...r.ui,currentProjectId:t}}))}setSidebarOpen(t){this.setState(r=>({...r,ui:{...r.ui,sidebarOpen:t}}))}setActiveView(t){this.setState(r=>({...r,ui:{...r.ui,activeView:t}}))}setLoading(t,r){this.setState(a=>({...a,loading:{...a.loading,[t]:r}}))}setError(t,r){this.setState(a=>({...a,errors:{...a.errors,[t]:r}}))}clearErrors(){this.setState(t=>({...t,errors:{agents:null,requirements:null,projects:null,network:null}}))}addToast(t){const r=Date.now().toString(),a={...t,id:r};this.setState(u=>({...u,toasts:[...u.toasts,a]}));const i=t.duration||5e3;setTimeout(()=>{this.removeToast(r)},i)}removeToast(t){this.setState(r=>({...r,toasts:r.toasts.filter(a=>a.id!==t)}))}clearToasts(){this.setState(t=>({...t,toasts:[]}))}setProgress(t){this.setState(r=>({...r,progress:t}))}setSyncStatus(t){this.setState(r=>({...r,sync:{...r.sync,status:t,lastSync:t==="idle"?new Date:r.sync.lastSync}}))}incrementPendingChanges(){this.setState(t=>({...t,sync:{...t.sync,pendingChanges:t.sync.pendingChanges+1}}))}decrementPendingChanges(){this.setState(t=>({...t,sync:{...t.sync,pendingChanges:Math.max(0,t.sync.pendingChanges-1)}}))}resetPendingChanges(){this.setState(t=>({...t,sync:{...t.sync,pendingChanges:0}}))}getSelectedAgent(){const{agents:t,ui:r}=this.state;return t.find(a=>a.id===r.selectedAgentId)||null}getSelectedRequirement(){const{outputRequirements:t,ui:r}=this.state;return t.find(a=>a.id===r.selectedRequirementId)||null}getCurrentProject(){const{projects:t,ui:r}=this.state;return t.find(a=>a.id===r.currentProjectId)||null}isLoading(){const{loading:t}=this.state;return Object.values(t).some(Boolean)}hasErrors(){const{errors:t}=this.state;return Object.values(t).some(r=>r!==null)}getAllErrors(){const{errors:t}=this.state;return Object.values(t).filter(r=>r!==null)}reset(){this.setState(q)}setPersistenceEnabled(t){this.persistenceEnabled=t}}const o=new C,S={setAgents:s=>o.setAgents(s),addAgent:s=>o.addAgent(s),updateAgent:(s,e)=>o.updateAgent(s,e),removeAgent:s=>o.removeAgent(s),setOutputRequirements:s=>o.setOutputRequirements(s),addOutputRequirement:s=>o.addOutputRequirement(s),updateOutputRequirement:(s,e)=>o.updateOutputRequirement(s,e),removeOutputRequirement:s=>o.removeOutputRequirement(s),setProjects:s=>o.setProjects(s),addProject:s=>o.addProject(s),updateProject:(s,e)=>o.updateProject(s,e),removeProject:s=>o.removeProject(s),setSelectedAgent:s=>o.setSelectedAgent(s),setSelectedRequirement:s=>o.setSelectedRequirement(s),setCurrentProject:s=>o.setCurrentProject(s),setSidebarOpen:s=>o.setSidebarOpen(s),setActiveView:s=>o.setActiveView(s),setLoading:(s,e)=>o.setLoading(s,e),setError:(s,e)=>o.setError(s,e),clearErrors:()=>o.clearErrors(),addToast:s=>o.addToast(s),removeToast:s=>o.removeToast(s),clearToasts:()=>o.clearToasts(),setProgress:s=>o.setProgress(s),setSyncStatus:s=>o.setSyncStatus(s),incrementPendingChanges:()=>o.incrementPendingChanges(),decrementPendingChanges:()=>o.decrementPendingChanges(),resetPendingChanges:()=>o.resetPendingChanges()},p=class p{constructor(){l(this,"errorLog",[]);l(this,"maxLogSize",100)}static getInstance(){return p.instance||(p.instance=new p),p.instance}handle(e,t={}){const r=this.classifyError(e,t);return this.logError(r),this.processError(r),r}classifyError(e,t){const a={...t,timestamp:new Date};return e instanceof g?this.handleAPIError(e,a):e instanceof R?this.handleNetworkError(e,a):e instanceof P?this.handleTimeoutError(e,a):e.name==="ValidationError"?this.handleValidationError(e,a):e.message.includes("localStorage")||e.message.includes("storage")?this.handleStorageError(e,a):t.component?this.handleComponentError(e,a):this.handleGenericError(e,a)}handleAPIError(e,t){const r=e.status||0;return r>=500?{error:e,context:t,severity:"high",recoverable:!0,userMessage:"Server error occurred. Please try again in a moment.",technicalMessage:`API Error ${r}: ${e.message}`}:r===429?{error:e,context:t,severity:"medium",recoverable:!0,userMessage:"Too many requests. Please wait a moment before trying again.",technicalMessage:`Rate limited: ${e.message}`}:r>=400?{error:e,context:t,severity:"medium",recoverable:!1,userMessage:"Invalid request. Please check your input and try again.",technicalMessage:`Client Error ${r}: ${e.message}`}:{error:e,context:t,severity:"medium",recoverable:!0,userMessage:"Request failed. Please try again.",technicalMessage:`API Error: ${e.message}`}}handleNetworkError(e,t){return{error:e,context:t,severity:"high",recoverable:!0,userMessage:"Network connection failed. Please check your internet connection and try again.",technicalMessage:`Network Error: ${e.message}`}}handleTimeoutError(e,t){return{error:e,context:t,severity:"medium",recoverable:!0,userMessage:"Request timed out. The server may be busy. Please try again.",technicalMessage:`Timeout Error: ${e.message}`}}handleValidationError(e,t){return{error:e,context:t,severity:"low",recoverable:!1,userMessage:"Please check your input and try again.",technicalMessage:`Validation Error: ${e.message}`}}handleStorageError(e,t){return{error:e,context:t,severity:"medium",recoverable:!0,userMessage:"Storage error occurred. Some data may not be saved locally.",technicalMessage:`Storage Error: ${e.message}`}}handleComponentError(e,t){return{error:e,context:t,severity:"medium",recoverable:!0,userMessage:`Error in ${t.component}. Please refresh the page if the problem persists.`,technicalMessage:`Component Error in ${t.component}: ${e.message}`}}handleGenericError(e,t){return{error:e,context:t,severity:"medium",recoverable:!0,userMessage:"An unexpected error occurred. Please try again.",technicalMessage:`Generic Error: ${e.message}`}}processError(e){this.updateErrorState(e),this.showUserNotification(e),e.severity==="critical"&&this.handleCriticalError(e)}updateErrorState(e){const{context:t}=e;t.action?.includes("agent")?S.setError("agents",e.userMessage):t.action?.includes("requirement")?S.setError("requirements",e.userMessage):t.action?.includes("project")?S.setError("projects",e.userMessage):(e.error instanceof R||e.error instanceof P)&&S.setError("network",e.userMessage)}showUserNotification(e){const t={message:e.userMessage,type:this.getToastType(e.severity),duration:this.getToastDuration(e.severity)};e.recoverable&&e.context.action&&(t.action={label:"Retry",handler:()=>this.retryAction(e.context)}),S.addToast(t)}getToastType(e){switch(e){case"critical":case"high":return"error";case"medium":return"warning";case"low":return"info";default:return"error"}}getToastDuration(e){switch(e){case"critical":return 0;case"high":return 1e4;case"medium":return 7e3;case"low":return 5e3;default:return 5e3}}handleCriticalError(e){this.logToExternalService(e),console.error("CRITICAL ERROR:",e)}retryAction(e){console.log("Retrying action:",e.action)}logError(e){this.errorLog.unshift(e),this.errorLog.length>this.maxLogSize&&(this.errorLog=this.errorLog.slice(0,this.maxLogSize))}logToExternalService(e){console.log("Would log to external service:",e)}getErrorLog(){return[...this.errorLog]}clearErrorLog(){this.errorLog=[]}getErrorStats(){const e=new Date,t=new Date(e.getTime()-3600*1e3),r={},a={};let i=0;return this.errorLog.forEach(u=>{r[u.severity]=(r[u.severity]||0)+1;const c=u.error.constructor.name;a[c]=(a[c]||0)+1,u.context.timestamp&&u.context.timestamp>t&&i++}),{total:this.errorLog.length,bySeverity:r,byType:a,recent:i}}};l(p,"instance");let E=p;const I=E.getInstance(),k=(s,e={})=>I.handle(s,e),w=(s,e,t)=>k(s,{action:e,component:t});class g extends Error{constructor(e,t,r,a){super(e),this.status=t,this.code=r,this.details=a,this.name="APIError"}static fromResponse(e,t){const r=t?.error||t?.message||`HTTP ${e.status}: ${e.statusText}`;return new g(r,e.status,t?.code,t)}}class R extends g{constructor(e="Network request failed"){super(e,0,"NETWORK_ERROR"),this.name="NetworkError"}}class P extends g{constructor(e){super(`Request timeout after ${e}ms`,0,"TIMEOUT_ERROR"),this.name="TimeoutError"}}class ${constructor(e={}){l(this,"baseURL");l(this,"timeout");l(this,"retryAttempts");l(this,"retryDelay");this.baseURL=e.baseURL||"/api",this.timeout=e.timeout||1e4,this.retryAttempts=e.retryAttempts||3,this.retryDelay=e.retryDelay||1e3}async request(e,t={}){let r;for(let a=0;a<=this.retryAttempts;a++){const i=new AbortController,u=setTimeout(()=>i.abort(),this.timeout);try{const c=`${this.baseURL}${e}`;console.log("API Request:",c);const h=await fetch(c,{headers:{"Content-Type":"application/json",...t.headers},signal:i.signal,...t});if(clearTimeout(u),h.ok){const f=h.headers.get("content-type");return f&&f.includes("application/json")?await h.json():h.text()}else{const f=await h.json().catch(()=>({})),T=g.fromResponse(h,f);if(h.status>=400&&h.status<500&&h.status!==408&&h.status!==429)throw T;r=T}}catch(c){clearTimeout(u),c instanceof g?r=c:c instanceof Error?c.name==="AbortError"?r=new P(this.timeout):c instanceof TypeError||c.message.includes("fetch")||c.message.includes("Failed to fetch")?r=new R(c.message):r=new g(c.message,0,"UNKNOWN_ERROR"):r=new g("Unknown error occurred",0,"UNKNOWN_ERROR")}a<this.retryAttempts&&await new Promise(c=>setTimeout(c,this.retryDelay*Math.pow(2,a)))}throw r||new g("Request failed after all retry attempts")}async healthCheck(){try{return await this.request("/health")}catch{return{status:"unknown",timestamp:new Date().toISOString()}}}async getAgents(){try{return await this.request("/agents")}catch(e){throw w(e,"get_agents","APIClient"),e}}async createAgent(e){try{return await this.request("/agents",{method:"POST",body:JSON.stringify(e)})}catch(t){throw w(t,"create_agent","APIClient"),t}}async updateAgent(e,t){return this.request(`/agents/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteAgent(e){await this.request(`/agents/${e}`,{method:"DELETE"})}async getRuleSets(){return this.request("/rules")}async createRuleSet(e){return this.request("/rules",{method:"POST",body:JSON.stringify(e)})}async updateRuleSet(e,t){return this.request(`/rules/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteRuleSet(e){await this.request(`/rules/${e}`,{method:"DELETE"})}async enhanceRules(e,t){return this.request(`/ai/enhance-rules/${e}`,{method:"POST",body:JSON.stringify(t)})}async getHooks(){return this.request("/hooks")}async createHook(e){return this.request("/hooks",{method:"POST",body:JSON.stringify(e)})}async updateHook(e,t){return this.request(`/hooks/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteHook(e){await this.request(`/hooks/${e}`,{method:"DELETE"})}async testHook(e,t){return this.request(`/hooks/${e}/test`,{method:"POST",body:JSON.stringify({context:t})})}async getOutputRequirements(){return this.request("/output-requirements")}async createOutputRequirement(e){return this.request("/output-requirements",{method:"POST",body:JSON.stringify(e)})}async updateOutputRequirement(e,t){return this.request(`/output-requirements/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteOutputRequirement(e){await this.request(`/output-requirements/${e}`,{method:"DELETE"})}async trackRequirementUsage(e){await this.request(`/output-requirements/${e}/use`,{method:"POST"})}async getProjects(){return this.request("/projects")}async getProject(e){return this.request(`/projects/${e}`)}async getProjectResources(e){return this.request(`/projects/${e}/resources`)}async assignResourceToProject(e,t,r){await this.request(`/projects/${e}/resources`,{method:"POST",body:JSON.stringify({resourceId:t,resourceType:r})})}async unassignResourceFromProject(e,t){await this.request(`/projects/${e}/resources/${t}`,{method:"DELETE"})}async getAvailableResources(e){return this.request(`/projects/${e}/available-resources`)}async importResourcesToProject(e,t){await this.request(`/projects/${e}/import`,{method:"POST",body:JSON.stringify({resources:t})})}async generatePromptFromTemplate(e,t){return this.request(`/projects/${e}/generate-from-template`,{method:"POST",body:JSON.stringify(t)})}async savePromptToProject(e,t){await this.request(`/projects/${e}/prompts`,{method:"POST",body:JSON.stringify(t)})}async createProject(e){return this.request("/projects",{method:"POST",body:JSON.stringify(e)})}async updateProject(e,t){return this.request(`/projects/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteProject(e){await this.request(`/projects/${e}`,{method:"DELETE"})}async getAISuggestions(e,t){return this.request("/ai/enhance-resource",{method:"POST",body:JSON.stringify({projectId:e,resourceType:"prompt",context:t})})}async exportProject(e,t){return this.request(`/export/claude-code/${e}`,{method:"POST",body:JSON.stringify(t)})}}const n=new $,D={agents:{list:()=>n.getAgents(),create:s=>n.createAgent(s),update:(s,e)=>n.updateAgent(s,e),delete:s=>n.deleteAgent(s)},requirements:{list:()=>n.getOutputRequirements(),create:s=>n.createOutputRequirement(s),update:(s,e)=>n.updateOutputRequirement(s,e),delete:s=>n.deleteOutputRequirement(s),trackUsage:s=>n.trackRequirementUsage(s)},projects:{list:()=>n.getProjects(),get:s=>n.getProject(s),create:s=>n.createProject(s),update:(s,e)=>n.updateProject(s,e),delete:s=>n.deleteProject(s),resources:s=>n.getProjectResources(s),assignResource:(s,e,t)=>n.assignResourceToProject(s,e,t),unassignResource:(s,e)=>n.unassignResourceFromProject(s,e),availableResources:s=>n.getAvailableResources(s),importResources:(s,e)=>n.importResourcesToProject(s,e)},rules:{list:()=>n.getRuleSets(),create:s=>n.createRuleSet(s),update:(s,e)=>n.updateRuleSet(s,e),delete:s=>n.deleteRuleSet(s)},hooks:{list:()=>n.getHooks(),create:s=>n.createHook(s),update:(s,e)=>n.updateHook(s,e),delete:s=>n.deleteHook(s),test:(s,e)=>n.testHook(s,e)},prompts:{generate:(s,e)=>n.generatePromptFromTemplate(s,e),save:(s,e)=>n.savePromptToProject(s,e)},ai:{getSuggestions:(s,e)=>n.getAISuggestions(s,e),enhanceRules:(s,e)=>n.enhanceRules(s,e)},export:{project:(s,e)=>n.exportProject(s,e)}};export{D as a};
