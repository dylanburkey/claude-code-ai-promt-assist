import{a as g}from"./api.CmHKHOM5.js";let l=[],u=null;document.addEventListener("DOMContentLoaded",async()=>{await y(),A()});async function y(){try{l=await g.agents.list(),v(),E()}catch(e){console.error("Failed to load agents:",e),s("Failed to load agents","error")}}function v(){const e=document.getElementById("agent-list");if(e){if(l.length===0){e.innerHTML='<div class="empty-state">No agents yet. Create one!</div>';return}e.innerHTML=l.map(t=>`
      <div class="item-card ${t.id===u?"active":""}" onclick="selectAgent('${t.id}')">
        <div class="item-card-header">
          <div class="item-name-group">
            <span class="item-name">${t.icon||"ðŸ¤–"} ${p(t.display_name||t.name)}</span>
            ${t.category?`<span class="item-category">${p(t.category)}</span>`:""}
          </div>
          <button class="btn-ghost btn-xs" onclick="event.stopPropagation(); editAgent('${t.id}')" title="Edit">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
          </button>
        </div>
        <p class="item-preview">${p(t.prompt_content||t.role||"")}</p>
      </div>
    `).join("")}}function E(){const e=document.getElementById("agents-count");e&&(e.textContent=l.length.toString())}function B(e){u=e;const t=l.find(n=>n.id===e);if(t){const n=document.getElementById("current-agent-display"),a=document.getElementById("clear-agent-btn");if(n){const o=n.querySelector(".selection-tag-name");o&&(o.textContent=t.name),n.classList.add("has-selection")}a&&(a.style.display="block"),document.dispatchEvent(new CustomEvent("agent-selected",{detail:{agent:t}}))}v()}function I(){u=null;const e=document.getElementById("current-agent-display"),t=document.getElementById("clear-agent-btn");if(e){const n=e.querySelector(".selection-tag-name");n&&(n.textContent="No agent selected"),e.classList.remove("has-selection")}t&&(t.style.display="none"),v()}function h(e){const t=l.find(i=>i.id===e);if(!t)return;const n=document.getElementById("agent-modal"),a=document.getElementById("agent-id"),o=document.getElementById("agent-name"),c=document.getElementById("agent-display-name"),d=document.getElementById("agent-prompt"),m=document.getElementById("agent-category"),r=document.getElementById("btn-delete-agent");a&&(a.value=t.id),o&&(o.value=t.name),c&&(c.value=t.display_name||""),d&&(d.value=t.prompt_content||t.role||""),m&&(m.value=t.category||""),r&&(r.style.display="block"),n&&n.classList.add("open")}function w(){const e=document.getElementById("agent-modal"),t=document.getElementById("agent-id"),n=document.getElementById("agent-name"),a=document.getElementById("agent-display-name"),o=document.getElementById("agent-prompt"),c=document.getElementById("agent-category"),d=document.getElementById("btn-delete-agent");t&&(t.value=""),n&&(n.value=""),a&&(a.value=""),o&&(o.value=""),c&&(c.value=""),d&&(d.style.display="none"),e&&e.classList.add("open")}async function L(){const e=document.getElementById("agent-id"),t=document.getElementById("agent-name"),n=document.getElementById("agent-display-name"),a=document.getElementById("agent-prompt"),o=document.getElementById("agent-category");if(!t||!a)return;const c=t.value.trim(),d=n?.value.trim()||"",m=a.value.trim(),r=o?.value.trim()||"general";if(!c||!m){s("Name and prompt content are required","error");return}try{const i={name:c,display_name:d,prompt_content:m,category:r,is_enabled:!0};e&&e.value?(await g.agents.update(e.value,i),s("Agent updated!")):(await g.agents.create(i),s("Agent created!")),await y(),f()}catch(i){console.error("Failed to save agent:",i),s("Failed to save agent","error")}}async function b(){const e=document.getElementById("agent-id");if(!e||!e.value)return;const t=l.find(n=>n.id===e.value);if(t&&confirm(`Delete agent "${t.name}"? This cannot be undone.`))try{await g.agents.delete(e.value),s("Agent deleted"),u===e.value&&I(),await y(),f()}catch(n){console.error("Failed to delete agent:",n),s("Failed to delete agent","error")}}function f(){const e=document.getElementById("agent-modal");e&&e.classList.remove("open")}function A(){document.querySelector("#agents-section .collapsible-header")?.addEventListener("click",()=>{const e=document.getElementById("agents-section");e&&e.classList.toggle("collapsed")}),document.getElementById("new-agent-btn")?.addEventListener("click",w),document.getElementById("clear-agent-btn")?.addEventListener("click",I),document.getElementById("btn-save-agent")?.addEventListener("click",L),document.getElementById("btn-delete-agent")?.addEventListener("click",b),document.getElementById("btn-cancel-agent")?.addEventListener("click",f)}function p(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function s(e,t="success"){const n=document.getElementById("toast");n&&(n.textContent=e,n.className=`toast ${t} show`,setTimeout(()=>n.classList.remove("show"),3e3))}window.selectAgent=B;window.editAgent=h;
