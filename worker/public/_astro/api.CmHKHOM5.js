var b=Object.defineProperty;var j=(r,e,t)=>e in r?b(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var l=(r,e,t)=>j(r,typeof e!="symbol"?e+"":e,t);const m={UI_STATE:"prompt_workstation_ui_state",SELECTED_AGENT:"prompt_workstation_selected_agent",SELECTED_REQUIREMENT:"prompt_workstation_selected_requirement",CURRENT_PROJECT:"prompt_workstation_current_project",FORM_DRAFTS:"prompt_workstation_form_drafts",THEME_PREFERENCES:"prompt_workstation_theme_preferences",CACHED_DATA:"prompt_workstation_cached_data"};class O{isAvailable(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}set(e,t){if(!this.isAvailable())return!1;try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch(s){return console.warn("Failed to save to localStorage:",s),!1}}get(e,t){if(!this.isAvailable())return t||null;try{const s=localStorage.getItem(e);return s?JSON.parse(s):t||null}catch(s){return console.warn("Failed to read from localStorage:",s),t||null}}remove(e){if(!this.isAvailable())return!1;try{return localStorage.removeItem(e),!0}catch(t){return console.warn("Failed to remove from localStorage:",t),!1}}clear(){if(!this.isAvailable())return!1;try{return localStorage.clear(),!0}catch(e){return console.warn("Failed to clear localStorage:",e),!1}}}const h=new O,q={save(r){const t={...this.load(),...r};return h.set(m.UI_STATE,t)},load(){return h.get(m.UI_STATE,{selectedAgentId:null,selectedRequirementId:null,currentProjectId:null,sidebarOpen:!1,activeView:"builder",syncStatus:"synced"})},clear(){return h.remove(m.UI_STATE)}},y={set(r,e,t=300*1e3){const s=this.getAll();return s[r]={data:e,timestamp:Date.now()+t},h.set(m.CACHED_DATA,s)},get(r){const t=this.getAll()[r];return t?Date.now()>t.timestamp?(this.remove(r),null):t.data:null},remove(r){const e=this.getAll();return delete e[r],h.set(m.CACHED_DATA,e)},getAll(){return h.get(m.CACHED_DATA,{})},clear(){return h.remove(m.CACHED_DATA)},isValid(r){const t=this.getAll()[r];return t?Date.now()<=t.timestamp:!1}},v={getUsage(){if(!h.isAvailable())return{used:0,available:0,percentage:0};let r=0;for(let s in localStorage)localStorage.hasOwnProperty(s)&&(r+=localStorage[s].length+s.length);const e=5*1024*1024,t=r/e*100;return{used:r,available:e,percentage:t}},cleanup(){const r=y.getAll();let e=!1;for(const t in r){const s=r[t];s&&Date.now()>s.timestamp&&(delete r[t],e=!0)}return e?h.set(m.CACHED_DATA,r):!0},exportAll(){const r={};for(const e of Object.values(m)){const t=h.get(e);t!==null&&(r[e]=t)}return r},importAll(r){try{for(const[e,t]of Object.entries(r))Object.values(m).includes(e)&&h.set(e,t);return!0}catch(e){return console.error("Failed to import storage data:",e),!1}}};typeof window<"u"&&v.cleanup();class C{constructor(e){l(this,"_state");l(this,"listeners",new Set);l(this,"errorHandlers",new Set);this._state=e}get state(){return this._state}setState(e){try{const t={...this._state};typeof e=="function"?this._state=e(this._state):this._state={...this._state,...e},this.listeners.forEach(s=>{try{s(this._state,t)}catch(a){this.handleError(a,"state_listener")}})}catch(t){this.handleError(t,"state_update")}}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}onError(e){return this.errorHandlers.add(e),()=>this.errorHandlers.delete(e)}handleError(e,t){this.errorHandlers.forEach(s=>{try{s(e,t)}catch(a){console.error("Error in error handler:",a)}}),this.errorHandlers.size===0&&console.error(`State error in ${t}:`,e)}}const A={agents:[],outputRequirements:[],projects:[],ui:{selectedAgentId:null,selectedRequirementId:null,currentProjectId:null,sidebarOpen:!1,activeView:"builder",syncStatus:"synced"},loading:{agents:!1,requirements:!1,projects:!1,saving:!1},errors:{agents:null,requirements:null,projects:null,network:null},toasts:[],progress:null,sync:{lastSync:null,status:"idle",pendingChanges:0}};class _ extends C{constructor(){super(A);l(this,"persistenceEnabled",!0);l(this,"autoSaveTimeout",null);this.loadPersistedState(),this.setupAutoSave()}loadPersistedState(){try{const t=q.load();this.setState(u=>({...u,ui:{...u.ui,...t}}));const s=y.get("agents"),a=y.get("requirements"),i=y.get("projects");s&&this.setState(u=>({...u,agents:s})),a&&this.setState(u=>({...u,outputRequirements:a})),i&&this.setState(u=>({...u,projects:i}))}catch(t){this.handleError(t,"load_persisted_state")}}setupAutoSave(){this.subscribe(t=>{this.persistenceEnabled&&(this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=window.setTimeout(()=>{this.persistState(t)},500))})}persistState(t){try{q.save(t.ui),y.set("agents",t.agents,600*1e3),y.set("requirements",t.outputRequirements,600*1e3),y.set("projects",t.projects,600*1e3)}catch(s){this.handleError(s,"persist_state")}}setAgents(t){this.setState(s=>({...s,agents:t,errors:{...s.errors,agents:null}}))}addAgent(t){this.setState(s=>({...s,agents:[...s.agents,t]}))}updateAgent(t,s){this.setState(a=>({...a,agents:a.agents.map(i=>i.id===t?{...i,...s}:i)}))}removeAgent(t){this.setState(s=>({...s,agents:s.agents.filter(a=>a.id!==t),ui:s.ui.selectedAgentId===t?{...s.ui,selectedAgentId:null}:s.ui}))}setOutputRequirements(t){this.setState(s=>({...s,outputRequirements:t,errors:{...s.errors,requirements:null}}))}addOutputRequirement(t){this.setState(s=>({...s,outputRequirements:[...s.outputRequirements,t]}))}updateOutputRequirement(t,s){this.setState(a=>({...a,outputRequirements:a.outputRequirements.map(i=>i.id===t?{...i,...s}:i)}))}removeOutputRequirement(t){this.setState(s=>({...s,outputRequirements:s.outputRequirements.filter(a=>a.id!==t),ui:s.ui.selectedRequirementId===t?{...s.ui,selectedRequirementId:null}:s.ui}))}setProjects(t){this.setState(s=>({...s,projects:t,errors:{...s.errors,projects:null}}))}addProject(t){this.setState(s=>({...s,projects:[...s.projects,t]}))}updateProject(t,s){this.setState(a=>({...a,projects:a.projects.map(i=>i.id===t?{...i,...s}:i)}))}removeProject(t){this.setState(s=>({...s,projects:s.projects.filter(a=>a.id!==t),ui:s.ui.currentProjectId===t?{...s.ui,currentProjectId:null}:s.ui}))}setSelectedAgent(t){this.setState(s=>({...s,ui:{...s.ui,selectedAgentId:t}}))}setSelectedRequirement(t){this.setState(s=>({...s,ui:{...s.ui,selectedRequirementId:t}}))}setCurrentProject(t){this.setState(s=>({...s,ui:{...s.ui,currentProjectId:t}}))}setSidebarOpen(t){this.setState(s=>({...s,ui:{...s.ui,sidebarOpen:t}}))}setActiveView(t){this.setState(s=>({...s,ui:{...s.ui,activeView:t}}))}setLoading(t,s){this.setState(a=>({...a,loading:{...a.loading,[t]:s}}))}setError(t,s){this.setState(a=>({...a,errors:{...a.errors,[t]:s}}))}clearErrors(){this.setState(t=>({...t,errors:{agents:null,requirements:null,projects:null,network:null}}))}addToast(t){const s=Date.now().toString(),a={...t,id:s};this.setState(u=>({...u,toasts:[...u.toasts,a]}));const i=t.duration||5e3;setTimeout(()=>{this.removeToast(s)},i)}removeToast(t){this.setState(s=>({...s,toasts:s.toasts.filter(a=>a.id!==t)}))}clearToasts(){this.setState(t=>({...t,toasts:[]}))}setProgress(t){this.setState(s=>({...s,progress:t}))}setSyncStatus(t){this.setState(s=>({...s,sync:{...s.sync,status:t,lastSync:t==="idle"?new Date:s.sync.lastSync}}))}incrementPendingChanges(){this.setState(t=>({...t,sync:{...t.sync,pendingChanges:t.sync.pendingChanges+1}}))}decrementPendingChanges(){this.setState(t=>({...t,sync:{...t.sync,pendingChanges:Math.max(0,t.sync.pendingChanges-1)}}))}resetPendingChanges(){this.setState(t=>({...t,sync:{...t.sync,pendingChanges:0}}))}getSelectedAgent(){const{agents:t,ui:s}=this.state;return t.find(a=>a.id===s.selectedAgentId)||null}getSelectedRequirement(){const{outputRequirements:t,ui:s}=this.state;return t.find(a=>a.id===s.selectedRequirementId)||null}getCurrentProject(){const{projects:t,ui:s}=this.state;return t.find(a=>a.id===s.currentProjectId)||null}isLoading(){const{loading:t}=this.state;return Object.values(t).some(Boolean)}hasErrors(){const{errors:t}=this.state;return Object.values(t).some(s=>s!==null)}getAllErrors(){const{errors:t}=this.state;return Object.values(t).filter(s=>s!==null)}reset(){this.setState(A)}setPersistenceEnabled(t){this.persistenceEnabled=t}}const o=new _,f={setAgents:r=>o.setAgents(r),addAgent:r=>o.addAgent(r),updateAgent:(r,e)=>o.updateAgent(r,e),removeAgent:r=>o.removeAgent(r),setOutputRequirements:r=>o.setOutputRequirements(r),addOutputRequirement:r=>o.addOutputRequirement(r),updateOutputRequirement:(r,e)=>o.updateOutputRequirement(r,e),removeOutputRequirement:r=>o.removeOutputRequirement(r),setProjects:r=>o.setProjects(r),addProject:r=>o.addProject(r),updateProject:(r,e)=>o.updateProject(r,e),removeProject:r=>o.removeProject(r),setSelectedAgent:r=>o.setSelectedAgent(r),setSelectedRequirement:r=>o.setSelectedRequirement(r),setCurrentProject:r=>o.setCurrentProject(r),setSidebarOpen:r=>o.setSidebarOpen(r),setActiveView:r=>o.setActiveView(r),setLoading:(r,e)=>o.setLoading(r,e),setError:(r,e)=>o.setError(r,e),clearErrors:()=>o.clearErrors(),addToast:r=>o.addToast(r),removeToast:r=>o.removeToast(r),clearToasts:()=>o.clearToasts(),setProgress:r=>o.setProgress(r),setSyncStatus:r=>o.setSyncStatus(r),incrementPendingChanges:()=>o.incrementPendingChanges(),decrementPendingChanges:()=>o.decrementPendingChanges(),resetPendingChanges:()=>o.resetPendingChanges()},p=class p{constructor(){l(this,"errorLog",[]);l(this,"maxLogSize",100)}static getInstance(){return p.instance||(p.instance=new p),p.instance}handle(e,t={}){const s=this.classifyError(e,t);return this.logError(s),this.processError(s),s}classifyError(e,t){const a={...t,timestamp:new Date};return e instanceof d?this.handleAPIError(e,a):e instanceof E?this.handleNetworkError(e,a):e instanceof T?this.handleTimeoutError(e,a):e.name==="ValidationError"?this.handleValidationError(e,a):e.message.includes("localStorage")||e.message.includes("storage")?this.handleStorageError(e,a):t.component?this.handleComponentError(e,a):this.handleGenericError(e,a)}handleAPIError(e,t){const s=e.status||0;return s>=500?{error:e,context:t,severity:"high",recoverable:!0,userMessage:"Server error occurred. Please try again in a moment.",technicalMessage:`API Error ${s}: ${e.message}`}:s===429?{error:e,context:t,severity:"medium",recoverable:!0,userMessage:"Too many requests. Please wait a moment before trying again.",technicalMessage:`Rate limited: ${e.message}`}:s===404?{error:e,context:t,severity:"medium",recoverable:!1,userMessage:"The requested item could not be found. It may have been deleted or moved.",technicalMessage:`Not Found ${s}: ${e.message}`}:s>=400?{error:e,context:t,severity:"medium",recoverable:!1,userMessage:"Invalid request. Please check your input and try again.",technicalMessage:`Client Error ${s}: ${e.message}`}:{error:e,context:t,severity:"medium",recoverable:!0,userMessage:"Request failed. Please try again.",technicalMessage:`API Error: ${e.message}`}}handleNetworkError(e,t){return{error:e,context:t,severity:"high",recoverable:!0,userMessage:"Network connection failed. Please check your internet connection and try again.",technicalMessage:`Network Error: ${e.message}`}}handleTimeoutError(e,t){return{error:e,context:t,severity:"medium",recoverable:!0,userMessage:"Request timed out. The server may be busy. Please try again.",technicalMessage:`Timeout Error: ${e.message}`}}handleValidationError(e,t){return{error:e,context:t,severity:"low",recoverable:!1,userMessage:"Please check your input and try again.",technicalMessage:`Validation Error: ${e.message}`}}handleStorageError(e,t){return{error:e,context:t,severity:"medium",recoverable:!0,userMessage:"Storage error occurred. Some data may not be saved locally.",technicalMessage:`Storage Error: ${e.message}`}}handleComponentError(e,t){return{error:e,context:t,severity:"medium",recoverable:!0,userMessage:`Error in ${t.component}. Please refresh the page if the problem persists.`,technicalMessage:`Component Error in ${t.component}: ${e.message}`}}handleGenericError(e,t){return{error:e,context:t,severity:"medium",recoverable:!0,userMessage:"An unexpected error occurred. Please try again.",technicalMessage:`Generic Error: ${e.message}`}}getRecoveryOptions(e,t){if(e instanceof d){const s=e.status||0;if(s===404)return["Refresh the page to reload data","Check if the item was deleted","Verify the item ID is correct"];if(s===409)return["Use a different name","Update the existing item instead","Delete the conflicting item first"];if(s>=500)return["Try again in a few moments","Check system status","Contact support if the problem persists"];if(s===429)return["Wait a moment before retrying","Reduce the frequency of requests"];if(s>=400)return["Review the highlighted fields","Check the format requirements","Verify all required fields are filled"]}return e instanceof E?["Check your internet connection","Try refreshing the page","Wait a moment and try again"]:e.message.includes("localStorage")||e.message.includes("storage")?["Clear browser cache and try again","Check available storage space","Try using a different browser"]:["Try the action again","Refresh the page if the problem persists","Contact support if the issue continues"]}processError(e){this.updateErrorState(e),this.showUserNotification(e),e.severity==="critical"&&this.handleCriticalError(e)}updateErrorState(e){const{context:t}=e;t.action?.includes("agent")?f.setError("agents",e.userMessage):t.action?.includes("requirement")?f.setError("requirements",e.userMessage):t.action?.includes("project")?f.setError("projects",e.userMessage):(e.error instanceof E||e.error instanceof T)&&f.setError("network",e.userMessage)}showUserNotification(e){const t=this.getRecoveryOptions(e.error,e.context),s={message:e.userMessage,type:this.getToastType(e.severity),duration:this.getToastDuration(e.severity),recoveryOptions:t.slice(0,2)};e.recoverable&&e.context.action&&(s.action={label:"Retry",handler:()=>this.retryAction(e.context)}),f.addToast(s)}getToastType(e){switch(e){case"critical":case"high":return"error";case"medium":return"warning";case"low":return"info";default:return"error"}}getToastDuration(e){switch(e){case"critical":return 0;case"high":return 1e4;case"medium":return 7e3;case"low":return 5e3;default:return 5e3}}handleCriticalError(e){this.logToExternalService(e),console.error("CRITICAL ERROR:",e)}retryAction(e){console.log("Retrying action:",e.action)}logError(e){this.errorLog.unshift(e),this.errorLog.length>this.maxLogSize&&(this.errorLog=this.errorLog.slice(0,this.maxLogSize))}logToExternalService(e){console.log("Would log to external service:",e)}getErrorLog(){return[...this.errorLog]}clearErrorLog(){this.errorLog=[]}getErrorStats(){const e=new Date,t=new Date(e.getTime()-3600*1e3),s={},a={};let i=0;return this.errorLog.forEach(u=>{s[u.severity]=(s[u.severity]||0)+1;const c=u.error.constructor.name;a[c]=(a[c]||0)+1,u.context.timestamp&&u.context.timestamp>t&&i++}),{total:this.errorLog.length,bySeverity:s,byType:a,recent:i}}};l(p,"instance");let R=p;const I=R.getInstance(),k=(r,e={})=>I.handle(r,e),w=(r,e,t)=>k(r,{action:e,component:t});class d extends Error{constructor(e,t,s,a){super(e),this.status=t,this.code=s,this.details=a,this.name="APIError"}static fromResponse(e,t){const s=t?.error||t?.message||`HTTP ${e.status}: ${e.statusText}`;return new d(s,e.status,t?.code,t)}}class E extends d{constructor(e="Network request failed"){super(e,0,"NETWORK_ERROR"),this.name="NetworkError"}}class T extends d{constructor(e){super(`Request timeout after ${e}ms`,0,"TIMEOUT_ERROR"),this.name="TimeoutError"}}class ${constructor(e={}){l(this,"baseURL");l(this,"timeout");l(this,"retryAttempts");l(this,"retryDelay");this.baseURL=e.baseURL||"/api",this.timeout=e.timeout||1e4,this.retryAttempts=e.retryAttempts||3,this.retryDelay=e.retryDelay||1e3}async request(e,t={}){let s;for(let a=0;a<=this.retryAttempts;a++){const i=new AbortController,u=setTimeout(()=>i.abort(),this.timeout);try{const c=`${this.baseURL}${e}`;console.log("API Request:",c);const g=await fetch(c,{headers:{"Content-Type":"application/json",...t.headers},signal:i.signal,...t});if(clearTimeout(u),g.ok){const S=g.headers.get("content-type");return S&&S.includes("application/json")?await g.json():g.text()}else{const S=await g.json().catch(()=>({})),P=d.fromResponse(g,S);if(g.status>=400&&g.status<500&&g.status!==408&&g.status!==429)throw P;s=P}}catch(c){clearTimeout(u),c instanceof d?s=c:c instanceof Error?c.name==="AbortError"?s=new T(this.timeout):c instanceof TypeError||c.message.includes("fetch")||c.message.includes("Failed to fetch")?s=new E(c.message):s=new d(c.message,0,"UNKNOWN_ERROR"):s=new d("Unknown error occurred",0,"UNKNOWN_ERROR")}a<this.retryAttempts&&await new Promise(c=>setTimeout(c,this.retryDelay*Math.pow(2,a)))}throw s||new d("Request failed after all retry attempts")}async healthCheck(){try{return await this.request("/health")}catch{return{status:"unknown",timestamp:new Date().toISOString()}}}async getAgents(){try{return await this.request("/agents")}catch(e){throw w(e,"get_agents","APIClient"),e}}async createAgent(e){try{return await this.request("/agents",{method:"POST",body:JSON.stringify(e)})}catch(t){throw w(t,"create_agent","APIClient"),t}}async updateAgent(e,t){return this.request(`/agents/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteAgent(e){await this.request(`/agents/${e}`,{method:"DELETE"})}async getRuleSets(){return this.request("/rules")}async createRuleSet(e){return this.request("/rules",{method:"POST",body:JSON.stringify(e)})}async updateRuleSet(e,t){return this.request(`/rules/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteRuleSet(e){await this.request(`/rules/${e}`,{method:"DELETE"})}async enhanceRules(e,t){return this.request(`/ai/enhance-rules/${e}`,{method:"POST",body:JSON.stringify(t)})}async getHooks(){return this.request("/hooks")}async createHook(e){return this.request("/hooks",{method:"POST",body:JSON.stringify(e)})}async updateHook(e,t){return this.request(`/hooks/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteHook(e){await this.request(`/hooks/${e}`,{method:"DELETE"})}async testHook(e,t){return this.request(`/hooks/${e}/test`,{method:"POST",body:JSON.stringify({context:t})})}async getOutputRequirements(){return this.request("/output-requirements")}async createOutputRequirement(e){return this.request("/output-requirements",{method:"POST",body:JSON.stringify(e)})}async updateOutputRequirement(e,t){return this.request(`/output-requirements/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteOutputRequirement(e){await this.request(`/output-requirements/${e}`,{method:"DELETE"})}async trackRequirementUsage(e){await this.request(`/output-requirements/${e}/use`,{method:"POST"})}async getProjects(){return this.request("/projects")}async getProject(e){return this.request(`/projects/${e}`)}async getProjectResources(e){return this.request(`/projects/${e}/resources`)}async assignResourceToProject(e,t,s){await this.request(`/projects/${e}/resources`,{method:"POST",body:JSON.stringify({resourceId:t,resourceType:s})})}async unassignResourceFromProject(e,t){await this.request(`/projects/${e}/resources/${t}`,{method:"DELETE"})}async getAvailableResources(e){return this.request(`/projects/${e}/available-resources`)}async importResourcesToProject(e,t){await this.request(`/projects/${e}/import`,{method:"POST",body:JSON.stringify({resources:t})})}async generatePromptFromTemplate(e,t){return this.request(`/projects/${e}/generate-from-template`,{method:"POST",body:JSON.stringify(t)})}async savePromptToProject(e,t){await this.request(`/projects/${e}/prompts`,{method:"POST",body:JSON.stringify(t)})}async createProject(e){return this.request("/projects",{method:"POST",body:JSON.stringify(e)})}async updateProject(e,t){return this.request(`/projects/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteProject(e){await this.request(`/projects/${e}`,{method:"DELETE"})}async getAISuggestions(e,t){return this.request("/ai/enhance-resource",{method:"POST",body:JSON.stringify({projectId:e,resourceType:"prompt",context:t})})}async exportProject(e,t){return this.request(`/export/claude-code/${e}`,{method:"POST",body:JSON.stringify(t)})}}const n=new $,D={agents:{list:()=>n.getAgents(),create:r=>n.createAgent(r),update:(r,e)=>n.updateAgent(r,e),delete:r=>n.deleteAgent(r)},requirements:{list:()=>n.getOutputRequirements(),create:r=>n.createOutputRequirement(r),update:(r,e)=>n.updateOutputRequirement(r,e),delete:r=>n.deleteOutputRequirement(r),trackUsage:r=>n.trackRequirementUsage(r)},projects:{list:()=>n.getProjects(),get:r=>n.getProject(r),create:r=>n.createProject(r),update:(r,e)=>n.updateProject(r,e),delete:r=>n.deleteProject(r),resources:r=>n.getProjectResources(r),assignResource:(r,e,t)=>n.assignResourceToProject(r,e,t),unassignResource:(r,e)=>n.unassignResourceFromProject(r,e),availableResources:r=>n.getAvailableResources(r),importResources:(r,e)=>n.importResourcesToProject(r,e)},rules:{list:()=>n.getRuleSets(),create:r=>n.createRuleSet(r),update:(r,e)=>n.updateRuleSet(r,e),delete:r=>n.deleteRuleSet(r)},hooks:{list:()=>n.getHooks(),create:r=>n.createHook(r),update:(r,e)=>n.updateHook(r,e),delete:r=>n.deleteHook(r),test:(r,e)=>n.testHook(r,e)},prompts:{generate:(r,e)=>n.generatePromptFromTemplate(r,e),save:(r,e)=>n.savePromptToProject(r,e)},ai:{getSuggestions:(r,e)=>n.getAISuggestions(r,e),enhanceRules:(r,e)=>n.enhanceRules(r,e)},export:{project:(r,e)=>n.exportProject(r,e)}};export{D as a};
